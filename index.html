<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>„Ç∞„ÉÉ„Ç∫ÁÆ°ÁêÜ (ÈÄ±ÈÇäÁÆ°ÁêÜ)</title>
    
    <!-- Âä†ËºâÂ∫´ÔºöÂ¶ÇÊûúÈÄôË£°Â†±ÈåØÔºåË´ãÁ¢∫Ë™çÁ∂≤Ë∑ØÈÄ£Á∑ö -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { 
            font-family: -apple-system, "Helvetica Neue", "Segoe UI", "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Noto Sans TC", sans-serif; 
            background-color: #F8F9FA; 
            margin: 0; 
            -webkit-tap-highlight-color: transparent; 
        }
        .ios-blur { 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px); 
        }
        .hide-scrollbar::-webkit-scrollbar { 
            display: none; 
        }
        .modal-up { 
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        @keyframes slideUp { 
            from { transform: translateY(100%); } 
            to { transform: translateY(0); } 
        }
        .file-input { 
            position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; 
            overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            const STORAGE_KEY = 'local_merch_data_v2';

            // ÂàùÂßãÂåñË≥áÊñôÔºåÂä†ÂÖ•ÈåØË™§ËôïÁêÜ
            const [products, setProducts] = useState(() => {
                try {
                    const saved = localStorage.getItem(STORAGE_KEY);
                    return saved ? JSON.parse(saved) : [];
                } catch (e) {
                    console.error("Failed to load data", e);
                    return [];
                }
            });

            const [searchQuery, setSearchQuery] = useState('');
            const [activeTab, setActiveTab] = useState('all');
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);
            const [errorMessage, setErrorMessage] = useState('');
            
            const fileInputRef = useRef(null);

            // Ë≥áÊñôÂêåÊ≠•ÔºåÂä†ÂÖ•Á©∫ÈñìÊ™¢Êü•
            useEffect(() => {
                try {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
                } catch (e) {
                    if (e.name === 'QuotaExceededError') {
                        setErrorMessage("„Çπ„Éà„É¨„Éº„Ç∏„Åå„ÅÑ„Å£„Å±„ÅÑ„Åß„Åô„ÄÇÂ§ß„Åç„Å™ÁîªÂÉè„ÅØÈÅø„Åë„Å¶„Åè„Å†„Åï„ÅÑ (Â≠òÂÑ≤Á©∫ÈñìÂ∑≤ÊªøÔºåË´ãÈÅøÂÖç‰∏äÂÇ≥Â§ßÂûãÂúñÁâá)");
                        setTimeout(() => setErrorMessage(''), 5000);
                    }
                }
            }, [products]);

            const categories = {
                all: { jp: "„Åô„Åπ„Å¶", zh: "ÂÖ®ÈÉ®" },
                acrylic: { jp: "„Ç¢„ÇØ„Çπ„Çø", zh: "Â£ìÂÖãÂäõ" },
                badge: { jp: "Áº∂„Éê„ÉÉ„Ç∏", zh: "ÂæΩÁ´†" },
                apparel: { jp: "„Ç¢„Éë„É¨„É´", zh: "ÊúçÈ£æ" },
                goods: { jp: "ÈõëË≤®", zh: "ÁîüÊ¥ªÁî®ÂìÅ" },
                others: { jp: "„Åù„ÅÆ‰ªñ", zh: "ÂÖ∂‰ªñ" }
            };

            const filteredProducts = products.filter(p => 
                (p.name.toLowerCase().includes(searchQuery.toLowerCase()) || 
                 p.series.toLowerCase().includes(searchQuery.toLowerCase())) &&
                (activeTab === 'all' || p.category === activeTab)
            );

            const openAddModal = () => {
                setEditingProduct({
                    id: Date.now(),
                    name: '',
                    series: '',
                    category: 'acrylic',
                    material: '',
                    memo: '',
                    image: ''
                });
                setIsModalOpen(true);
            };

            const handleSave = () => {
                if (!editingProduct.name.trim()) {
                    setErrorMessage("ÂïÜÂìÅÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ (Ë´ãËº∏ÂÖ•ÂïÜÂìÅÂêçÁ®±)");
                    setTimeout(() => setErrorMessage(''), 3000);
                    return;
                }
                
                const exists = products.find(p => p.id === editingProduct.id);
                if (exists) {
                    setProducts(products.map(p => p.id === editingProduct.id ? editingProduct : p));
                } else {
                    setProducts([editingProduct, ...products]);
                }
                setIsModalOpen(false);
            };

            const handleDelete = (id) => {
                setProducts(products.filter(p => p.id !== id));
                setIsModalOpen(false);
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 2 * 1024 * 1024) { // 2MB ÈôêÂà∂
                        setErrorMessage("ÁîªÂÉè„ÅåÂ§ß„Åç„Åô„Åé„Åæ„Åô (2MB‰ª•‰∏ãÊé®Â•®)");
                        setTimeout(() => setErrorMessage(''), 3000);
                        return;
                    }
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setEditingProduct(prev => ({ ...prev, image: reader.result }));
                    };
                    reader.readAsDataURL(file);
                }
            };

            return (
                <div className="max-w-md mx-auto min-h-screen pb-10 bg-[#F8F9FA] relative">
                    {/* Error Toast */}
                    {errorMessage && (
                        <div className="fixed top-5 left-1/2 -translate-x-1/2 z-[100] bg-red-600 text-white px-6 py-3 rounded-full shadow-xl text-xs font-bold whitespace-nowrap">
                            {errorMessage}
                        </div>
                    )}

                    {/* Header */}
                    <div className="p-6 pt-10">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h1 className="text-3xl font-black text-slate-800 tracking-tight">G-Manager</h1>
                                <p className="text-[10px] text-slate-400 font-bold tracking-widest uppercase">My Merch Collection</p>
                            </div>
                            <button 
                                onClick={openAddModal}
                                className="bg-indigo-600 text-white w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg active:scale-90 transition-all text-2xl"
                            >+</button>
                        </div>

                        {/* Search Bar */}
                        <div className="bg-white rounded-2xl flex items-center px-5 py-4 mb-6 shadow-sm border border-slate-100 focus-within:ring-2 ring-indigo-100 transition-all">
                            <span className="mr-3 opacity-30">üîç</span>
                            <input 
                                className="bg-transparent border-none outline-none w-full text-sm font-medium placeholder-slate-300" 
                                placeholder="Ê§úÁ¥¢... (ÊêúÂ∞ãÂïÜÂìÅÊàñ‰ΩúÂìÅ)" 
                                value={searchQuery} 
                                onChange={e => setSearchQuery(e.target.value)} 
                            />
                        </div>

                        {/* Tabs */}
                        <div className="flex overflow-x-auto hide-scrollbar gap-2 mb-8">
                            {Object.entries(categories).map(([key, label]) => (
                                <button 
                                    key={key} 
                                    onClick={() => setActiveTab(key)} 
                                    className={`px-5 py-2.5 rounded-xl text-xs font-bold whitespace-nowrap transition-all ${activeTab === key ? 'bg-indigo-600 text-white shadow-md' : 'bg-white text-slate-400 border border-slate-200'}`}
                                >
                                    {label.jp} <span className="text-[9px] opacity-60 ml-0.5 font-normal">{label.zh}</span>
                                </button>
                            ))}
                        </div>

                        {/* Grid List */}
                        <div className="grid grid-cols-2 gap-4">
                            {filteredProducts.map(p => (
                                <div 
                                    key={p.id} 
                                    onClick={() => { setEditingProduct({...p}); setIsModalOpen(true); }} 
                                    className="bg-white rounded-[2rem] overflow-hidden shadow-sm border border-slate-100 active:scale-95 transition-all group"
                                >
                                    <div 
                                        className="h-40 bg-cover bg-center bg-slate-50 flex items-center justify-center transition-transform group-hover:scale-105" 
                                        style={{ backgroundImage: p.image ? `url(${p.image})` : 'none' }}
                                    >
                                        {!p.image && <span className="text-slate-200 text-3xl">üì¶</span>}
                                    </div>
                                    <div className="p-4 bg-white">
                                        <p className="text-[9px] text-indigo-500 font-black truncate uppercase tracking-wider mb-1">{p.series || 'No Series'}</p>
                                        <h3 className="font-bold text-sm text-slate-800 truncate leading-tight">{p.name || 'Êú™ÂëΩÂêç'}</h3>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {filteredProducts.length === 0 && (
                            <div className="text-center py-20 bg-white/50 rounded-3xl border border-dashed border-slate-200">
                                <p className="text-slate-400 text-xs font-bold tracking-widest">DATA EMPTY (ÁÑ°ÊêúÂ∞ãÁµêÊûú)</p>
                            </div>
                        )}
                    </div>

                    {/* Editor Modal */}
                    {isModalOpen && editingProduct && (
                        <div className="fixed inset-0 z-50 flex items-end">
                            <div className="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onClick={() => setIsModalOpen(false)} />
                            <div className="relative w-full max-w-md mx-auto bg-[#F2F2F7] rounded-t-[2.5rem] h-[92vh] flex flex-col modal-up overflow-hidden shadow-2xl">
                                <div className="flex justify-between items-center px-8 py-6 bg-white border-b border-slate-100">
                                    <button onClick={() => setIsModalOpen(false)} className="text-slate-400 text-sm font-bold">Èñâ„Åò„Çã (ÈóúÈñâ)</button>
                                    <h2 className="font-black text-slate-800 tracking-wider">DETAILS</h2>
                                    <button onClick={handleSave} className="text-indigo-600 font-black text-sm">‰øùÂ≠ò„Åô„Çã (ÂÑ≤Â≠ò)</button>
                                </div>

                                <div className="flex-1 overflow-y-auto p-8 space-y-5">
                                    {/* Photo */}
                                    <div className="flex flex-col items-center">
                                        <div 
                                            className="w-56 h-56 bg-white rounded-[2.5rem] shadow-xl flex items-center justify-center overflow-hidden border-8 border-white cursor-pointer group" 
                                            onClick={() => fileInputRef.current.click()}
                                        >
                                            {editingProduct.image ? (
                                                <img src={editingProduct.image} className="w-full h-full object-cover" />
                                            ) : (
                                                <div className="text-center group-hover:scale-110 transition-transform">
                                                    <span className="text-5xl block mb-3">üñºÔ∏è</span>
                                                    <span className="text-[10px] text-slate-300 font-bold uppercase tracking-widest">Add Photo</span>
                                                </div>
                                            )}
                                        </div>
                                        <input type="file" ref={fileInputRef} className="file-input" onChange={handleImageUpload} accept="image/*" />
                                    </div>

                                    {/* Fields */}
                                    <div className="space-y-4">
                                        <div className="bg-white p-5 rounded-3xl border border-slate-100">
                                            <label className="text-[9px] text-slate-400 block mb-2 font-black uppercase tracking-widest">ÂïÜÂìÅÂêç / Product Name</label>
                                            <input 
                                                className="w-full bg-transparent outline-none font-bold text-slate-800 text-lg" 
                                                value={editingProduct.name} 
                                                placeholder="ÂêçÁ®±„ÇíÂÖ•Âäõ..."
                                                onChange={e => setEditingProduct({...editingProduct, name: e.target.value})} 
                                            />
                                        </div>

                                        <div className="grid grid-cols-1 gap-4">
                                            <div className="bg-white p-5 rounded-3xl border border-slate-100">
                                                <label className="text-[9px] text-slate-400 block mb-2 font-black uppercase tracking-widest">‰ΩúÂìÅÂêç / Series</label>
                                                <input 
                                                    className="w-full bg-transparent outline-none font-bold text-slate-700" 
                                                    value={editingProduct.series} 
                                                    placeholder="‰ΩúÂìÅÁ≥ªÂàó..."
                                                    onChange={e => setEditingProduct({...editingProduct, series: e.target.value})} 
                                                />
                                            </div>
                                            <div className="bg-white p-5 rounded-3xl border border-slate-100">
                                                <label className="text-[9px] text-slate-400 block mb-2 font-black uppercase tracking-widest">„Ç´„ÉÜ„Ç¥„É™ / Category</label>
                                                <select 
                                                    className="w-full bg-transparent outline-none font-black text-indigo-600 appearance-none cursor-pointer" 
                                                    value={editingProduct.category} 
                                                    onChange={e => setEditingProduct({...editingProduct, category: e.target.value})}
                                                >
                                                    {Object.entries(categories).filter(([k]) => k !== 'all').map(([k, v]) => (
                                                        <option key={k} value={k}>{v.jp} ({v.zh})</option>
                                                    ))}
                                                </select>
                                            </div>
                                        </div>

                                        <div className="bg-white p-5 rounded-3xl border border-slate-100">
                                            <label className="text-[9px] text-slate-400 block mb-2 font-black uppercase tracking-widest">ÊùêË≥™„Éª„Çµ„Ç§„Ç∫ / Note</label>
                                            <textarea 
                                                className="w-full bg-transparent outline-none text-sm h-24 resize-none text-slate-600 leading-relaxed font-medium" 
                                                value={editingProduct.memo} 
                                                placeholder="Ë©≥ÊÉÖ„ÇÑ„É°„É¢„ÇíÂÖ•Âäõ..."
                                                onChange={e => setEditingProduct({...editingProduct, memo: e.target.value})} 
                                            />
                                        </div>

                                        <button 
                                            onClick={() => {
                                                if(confirm("„Åì„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü (Á¢∫ÂÆöË¶ÅÂà™Èô§ÂóéÔºü)")) {
                                                    handleDelete(editingProduct.id);
                                                }
                                            }} 
                                            className="w-full py-5 text-red-500 font-black text-xs uppercase tracking-widest hover:bg-red-50 rounded-3xl transition-colors"
                                        >
                                            DELETE ITEM (Âà™Èô§È†ÖÁõÆ)
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
