<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>„Ç∞„ÉÉ„Ç∫ÁÆ°ÁêÜ („É≠„Éº„Ç´„É´Áâà)</title>
    
    <!-- ÂøÖË¶Å„Å™„É©„Ç§„Éñ„É©„É™ÔºöCDNÁµåÁî±„Åß„É≠„Éº„Éâ -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- üîπ Âú® React / Babel ‰πãÂæå -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

  const app = initializeApp({
  apiKey: "AIzaSyBmnMiQ_uXKbjiLaPqiAppcxUfQ8Bdf3rc",
  authDomain: "company-internal-goods.firebaseapp.com",
  projectId: "company-internal-goods",
  storageBucket: "company-internal-goods.appspot.com",
  appId: "1:439442142491:web:2996e6e38525353323cfbe"
});

window.firebaseDb = getFirestore(app);
window.firebaseStorage = getStorage(app);
</script>

    
    <style>
        body { 
            font-family: -apple-system, "Helvetica Neue", "Segoe UI", "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif; 
            background-color: #F8F9FA; 
            margin: 0; 
            -webkit-tap-highlight-color: transparent; 
        }
        .ios-blur { 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px); 
        }
        .hide-scrollbar::-webkit-scrollbar { 
            display: none; 
        }
        .modal-up { 
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        @keyframes slideUp { 
            from { transform: translateY(100%); } 
            to { transform: translateY(0); } 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const STORAGE_KEY = 'local_merch_manager_v1';

        const categories = {
            all: { jp: "„Åô„Åπ„Å¶", zh: "ÂÖ®ÈÉ®" },
            acrylic: { jp: "„Ç¢„ÇØ„Çπ„Çø", zh: "Â£ìÂÖãÂäõ" },
            badge: { jp: "Áº∂„Éê„ÉÉ„Ç∏", zh: "ÂæΩÁ´†" },
            apparel: { jp: "„Ç¢„Éë„É¨„É´", zh: "ÊúçÈ£æ" },
            goods: { jp: "ÁîüÊ¥ªÈõëË≤®", zh: "ÁîüÊ¥ªÁî®ÂìÅ" },
            others: { jp: "„Åù„ÅÆ‰ªñ", zh: "ÂÖ∂‰ªñ" }
        };

        function App() {
            // ÂàùÊúüÂåñÔºö„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄ
            const [products, setProducts] = useState(() => {
                const saved = localStorage.getItem(STORAGE_KEY);
                return saved ? JSON.parse(saved) : [];
            });

            const [searchQuery, setSearchQuery] = useState('');
            const [activeTab, setActiveTab] = useState('all');
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);
            const [errorMessage, setErrorMessage] = useState('');
            const fileInputRef = useRef(null);

            // „Éá„Éº„Çø„ÅåÂ§âÊõ¥„Åï„Çå„Åü„Çâ„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
            useEffect(() => {
                try {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
                } catch (e) {
                    if (e.name === 'QuotaExceededError') {
                        setErrorMessage("„Çπ„Éà„É¨„Éº„Ç∏„Åå„ÅÑ„Å£„Å±„ÅÑ„Åß„Åô„ÄÇÁîªÂÉè„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂ∞è„Åï„Åè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
                    }
                }
            }, [products]);

            const handleImageUpload = (e) => {
    const file = e.target.files[0];
    if (!file) return;

    if (file.size > 1.5 * 1024 * 1024) { 
        setErrorMessage("ÁîªÂÉè„ÅåÂ§ß„Åç„Åô„Åé„Åæ„Åô (1.5MB‰ª•‰∏ãÊé®Â•®)");
        setTimeout(() => setErrorMessage(''), 3000);
        return;
    }

    const reader = new FileReader();
    reader.onloadend = () => {
        setEditingProduct(prev => ({
            ...prev,
            image: reader.result
        }));
    };
    reader.readAsDataURL(file);
};


            const handleSave = async () => {
    if (!editingProduct.name.trim()) {
        setErrorMessage("ÂïÜÂìÅÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ");
        setTimeout(() => setErrorMessage(''), 3000);
        return;
    }

    if (!editingProduct.id) {
        await window.addDoc(
    window.collection(window.firebaseDb, "products"),
    {
        name: editingProduct.name,
        series: editingProduct.series,
        category: editingProduct.category,
        memo: editingProduct.memo,
        image: editingProduct.image || "",
        createdAt: window.serverTimestamp()
    }
);

    }

    // Êú¨Âú∞‰ªçÁÑ∂ÁÖßÂéüÊú¨ÊñπÂºè
    if (editingProduct.id) {
        setProducts(products.map(p => p.id === editingProduct.id ? editingProduct : p));
    } else {
        const newProduct = { ...editingProduct, id: Date.now().toString() };
        setProducts([newProduct, ...products]);
    }

    setIsModalOpen(false);
};

            const handleDelete = (id) => {
                setProducts(products.filter(p => p.id !== id));
                setIsModalOpen(false);
            };

            const filteredProducts = products.filter(p => 
                (p.name.toLowerCase().includes(searchQuery.toLowerCase()) || 
                 p.series.toLowerCase().includes(searchQuery.toLowerCase())) &&
                (activeTab === 'all' || p.category === activeTab)
            );

            return (
                <div className="max-w-md mx-auto min-h-screen pb-10 bg-[#F8F9FA] relative">
                    {/* „Ç®„É©„Éº„Éà„Éº„Çπ„Éà */}
                    {errorMessage && (
                        <div className="fixed top-5 left-1/2 -translate-x-1/2 z-[100] bg-red-600 text-white px-6 py-3 rounded-full shadow-xl text-xs font-bold">
                            {errorMessage}
                        </div>
                    )}

                    {/* „Éò„ÉÉ„ÉÄ„Éº */}
                    <div className="p-6 pt-10">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h1 className="text-3xl font-black text-slate-800 tracking-tight">G-Manager</h1>
                                <p className="text-[10px] text-slate-400 font-bold tracking-widest uppercase">My Collection</p>
                            </div>
                            <button 
                                onClick={() => {
                                    setEditingProduct({ name: '', series: '', category: 'acrylic', memo: '', image: '' });
                                    setIsModalOpen(true);
                                }}
                                className="bg-indigo-600 text-white w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg active:scale-90 transition-all text-2xl"
                            >+</button>
                        </div>

                        {/* Ê§úÁ¥¢„Éê„Éº */}
                        <div className="bg-white rounded-2xl flex items-center px-5 py-4 mb-6 shadow-sm border border-slate-100">
                            <span className="mr-3 opacity-30">üîç</span>
                            <input 
                                className="bg-transparent border-none outline-none w-full text-sm font-medium" 
                                placeholder="ÂïÜÂìÅÂêç„ÇÑ„Ç∑„É™„Éº„Ç∫„ÅßÊ§úÁ¥¢..." 
                                value={searchQuery} 
                                onChange={e => setSearchQuery(e.target.value)} 
                            />
                        </div>

                        {/* „Ç´„ÉÜ„Ç¥„É™„Çø„Éñ */}
                        <div className="flex overflow-x-auto hide-scrollbar gap-2 mb-8">
                            {Object.entries(categories).map(([key, label]) => (
                                <button 
                                    key={key} 
                                    onClick={() => setActiveTab(key)} 
                                    className={`px-5 py-2.5 rounded-xl text-xs font-bold whitespace-nowrap transition-all ${activeTab === key ? 'bg-indigo-600 text-white shadow-md' : 'bg-white text-slate-400 border border-slate-200'}`}
                                >
                                    {label.jp}
                                </button>
                            ))}
                        </div>

                        {/* ÂïÜÂìÅ‰∏ÄË¶ß */}
                        <div className="grid grid-cols-2 gap-4">
                            {filteredProducts.map(p => (
                                <div 
                                    key={p.id} 
                                    onClick={() => { setEditingProduct({...p}); setIsModalOpen(true); }} 
                                    className="bg-white rounded-[2rem] overflow-hidden shadow-sm border border-slate-100 active:scale-95 transition-all group"
                                >
                                    <div className="h-40 bg-slate-50 flex items-center justify-center overflow-hidden">
                                        {p.image ? (
                                            <img src={p.image} className="w-full h-full object-cover" />
                                        ) : (
                                            <span className="text-slate-200 text-3xl">üì¶</span>
                                        )}
                                    </div>
                                    <div className="p-4">
                                        <p className="text-[9px] text-indigo-500 font-black truncate uppercase mb-1">{p.series || 'No Series'}</p>
                                        <h3 className="font-bold text-sm text-slate-800 truncate">{p.name || 'Êú™Ë®≠ÂÆö'}</h3>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {filteredProducts.length === 0 && (
                            <div className="text-center py-20 bg-white/50 rounded-3xl border border-dashed border-slate-200 mt-4">
                                <p className="text-slate-400 text-xs font-bold">„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</p>
                            </div>
                        )}
                    </div>

                    {/* Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ */}
                    {isModalOpen && editingProduct && (
                        <div className="fixed inset-0 z-50 flex items-end">
                            <div className="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onClick={() => setIsModalOpen(false)} />
                            <div className="relative w-full max-w-md mx-auto bg-[#F2F2F7] rounded-t-[2.5rem] h-[90vh] flex flex-col modal-up overflow-hidden">
                                <div className="flex justify-between items-center px-8 py-6 bg-white border-b border-slate-100">
                                    <button onClick={() => setIsModalOpen(false)} className="text-slate-400 text-sm font-bold">„Ç≠„É£„É≥„Çª„É´</button>
                                    <h2 className="font-black text-slate-800 tracking-wider">DETAILS</h2>
                                    <button onClick={handleSave} className="text-indigo-600 font-black text-sm">‰øùÂ≠ò</button>
                                </div>

                                <div className="flex-1 overflow-y-auto p-8 space-y-6">
                                    <div className="flex flex-col items-center">
                                        <div 
                                            className="w-48 h-48 bg-white rounded-[2rem] shadow-xl flex items-center justify-center overflow-hidden border-4 border-white cursor-pointer" 
                                            onClick={() => fileInputRef.current.click()}
                                        >
                                            {editingProduct.image ? (
                                                <img src={editingProduct.image} className="w-full h-full object-cover" />
                                            ) : (
                                                <div className="text-center">
                                                    <span className="text-4xl block mb-2">üì∏</span>
                                                    <span className="text-[10px] text-slate-300 font-bold uppercase">ÂÜôÁúü„ÇíËøΩÂä†</span>
                                                </div>
                                            )}
                                        </div>
                                        <input type="file" ref={fileInputRef} className="hidden" onChange={handleImageUpload} accept="image/*" />
                                    </div>

                                    <div className="space-y-4">
                                        <div className="bg-white p-4 rounded-2xl border border-slate-100">
                                            <label className="text-[9px] text-slate-400 block mb-1 font-black uppercase">ÂïÜÂìÅÂêç</label>
                                            <input 
                                                className="w-full bg-transparent outline-none font-bold text-slate-800" 
                                                placeholder="‰æãÔºö„Ç¢„ÇØ„É™„É´„Çπ„Çø„É≥„Éâ"
                                                value={editingProduct.name} 
                                                onChange={e => setEditingProduct({...editingProduct, name: e.target.value})} 
                                            />
                                        </div>
                                        <div className="bg-white p-4 rounded-2xl border border-slate-100">
                                            <label className="text-[9px] text-slate-400 block mb-1 font-black uppercase">„Ç∑„É™„Éº„Ç∫ / ‰ΩúÂìÅ</label>
                                            <input 
                                                className="w-full bg-transparent outline-none font-bold text-slate-700" 
                                                placeholder="‰æãÔºö„Éõ„É≠„É©„Ç§„Éñ"
                                                value={editingProduct.series} 
                                                onChange={e => setEditingProduct({...editingProduct, series: e.target.value})} 
                                            />
                                        </div>
                                        <div className="bg-white p-4 rounded-2xl border border-slate-100">
                                            <label className="text-[9px] text-slate-400 block mb-1 font-black uppercase">„Ç´„ÉÜ„Ç¥„É™</label>
                                            <select 
                                                className="w-full bg-transparent outline-none font-black text-indigo-600 appearance-none" 
                                                value={editingProduct.category} 
                                                onChange={e => setEditingProduct({...editingProduct, category: e.target.value})}
                                            >
                                                {Object.entries(categories).filter(([k]) => k !== 'all').map(([k, v]) => (
                                                    <option key={k} value={k}>{v.jp}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div className="bg-white p-4 rounded-2xl border border-slate-100">
                                            <label className="text-[9px] text-slate-400 block mb-1 font-black uppercase">„É°„É¢</label>
                                            <textarea 
                                                className="w-full bg-transparent outline-none text-sm h-24 resize-none" 
                                                placeholder="Ë≥ºÂÖ•Â†¥ÊâÄ„ÇÑ‰æ°Ê†º„Å™„Å©..."
                                                value={editingProduct.memo} 
                                                onChange={e => setEditingProduct({...editingProduct, memo: e.target.value})} 
                                            />
                                        </div>

                                        {editingProduct.id && (
                                            <button 
                                                onClick={() => { if(confirm("„Åì„ÅÆÂïÜÂìÅ„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü")) handleDelete(editingProduct.id); }} 
                                                className="w-full py-4 text-red-500 font-black text-xs uppercase tracking-widest"
                                            >
                                                ÂïÜÂìÅ„ÇíÂâäÈô§„Åô„Çã
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
